<div class="container mt-4 mb-5">
  <div class="card">
    <div class="card-header bg-success text-white">
      <h2 class="mb-0">{{ isEditMode ? 'Edit Survey' : 'Student Survey Form' }}</h2>
      <p class="mb-0 mt-2">Please provide your feedback about your campus visit</p>
    </div>

    <div class="card-body">
      <!-- Success Message -->
      <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
        <strong>Success!</strong> {{ successMessage }}
        <button type="button" class="btn-close" (click)="successMessage = ''" aria-label="Close"></button>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
        <strong>Error!</strong> {{ errorMessage }}
        <button type="button" class="btn-close" (click)="errorMessage = ''" aria-label="Close"></button>
      </div>

      <form [formGroup]="surveyForm" (ngSubmit)="onSubmit()">

        <!-- Personal Information Section -->
        <div class="section-header mt-3">
          <h4>Personal Information</h4>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="firstName" class="form-label">First Name <span class="text-danger">*</span></label>
            <input
              type="text"
              class="form-control"
              id="firstName"
              formControlName="firstName"
              [class.is-invalid]="hasError('firstName')"
              placeholder="Enter your first name">
            <div class="invalid-feedback" *ngIf="hasError('firstName')">
              {{ getErrorMessage('firstName') }}
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="lastName" class="form-label">Last Name <span class="text-danger">*</span></label>
            <input
              type="text"
              class="form-control"
              id="lastName"
              formControlName="lastName"
              [class.is-invalid]="hasError('lastName')"
              placeholder="Enter your last name">
            <div class="invalid-feedback" *ngIf="hasError('lastName')">
              {{ getErrorMessage('lastName') }}
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
            <input
              type="email"
              class="form-control"
              id="email"
              formControlName="email"
              [class.is-invalid]="hasError('email')"
              placeholder="your.email@example.com">
            <div class="invalid-feedback" *ngIf="hasError('email')">
              {{ getErrorMessage('email') }}
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="phoneNumber" class="form-label">Phone Number</label>
            <input
              type="tel"
              class="form-control"
              id="phoneNumber"
              formControlName="phoneNumber"
              placeholder="(123) 456-7890">
          </div>
        </div>

        <!-- Address Information Section -->
        <div class="section-header mt-4">
          <h4>Address Information</h4>
        </div>

        <div class="mb-3">
          <label for="streetAddress" class="form-label">Street Address <span class="text-danger">*</span></label>
          <input
            type="text"
            class="form-control"
            id="streetAddress"
            formControlName="streetAddress"
            [class.is-invalid]="hasError('streetAddress')"
            placeholder="123 Main Street">
          <div class="invalid-feedback" *ngIf="hasError('streetAddress')">
            {{ getErrorMessage('streetAddress') }}
          </div>
        </div>

        <div class="row">
          <div class="col-md-3 mb-3">
            <label for="zipCode" class="form-label">ZIP Code <span class="text-danger">*</span></label>
            <input
              type="text"
              class="form-control"
              id="zipCode"
              formControlName="zipCode"
              placeholder="e.g., 22030"
                    (blur)="onZipCodeBlur()" >
                  <div class="invalid-feedback" *ngIf="hasError('zipCode')">
                    {{ getErrorMessage('zipCode') }}
            </div>
          </div>

          <div class="col-md-5 mb-3">
            <label for="city" class="form-label">City <span class="text-danger">*</span></label>
            <input
              type="text"
              class="form-control"
              id="city"
              formControlName="city"
              [class.is-invalid]="hasError('city')"
              placeholder="Auto-filled from ZIP">
            <div class="invalid-feedback" *ngIf="hasError('city')">
              {{ getErrorMessage('city') }}
            </div>
          </div>

          <div class="col-md-4 mb-3">
            <label for="state" class="form-label">State <span class="text-danger">*</span></label>
            <input
              type="text"
              class="form-control"
              id="state"
              formControlName="state"
              [class.is-invalid]="hasError('state')"
              placeholder="Auto-filled from ZIP">
            <div class="invalid-feedback" *ngIf="hasError('state')">
              {{ getErrorMessage('state') }}
            </div>
          </div>
        </div>

        <!-- Survey Details Section -->
        <div class="section-header mt-4">
          <h4>Survey Details</h4>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="surveyDate" class="form-label">Date of Campus Visit <span class="text-danger">*</span></label>
            <input
              type="date"
              class="form-control"
              id="surveyDate"
              formControlName="surveyDate"
              [class.is-invalid]="hasError('surveyDate')">
            <div class="invalid-feedback" *ngIf="hasError('surveyDate')">
              {{ getErrorMessage('surveyDate') }}
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="recommendation" class="form-label">Likelihood of Recommending School <span class="text-danger">*</span></label>
            <select
              class="form-select"
              id="recommendation"
              formControlName="recommendation"
              [class.is-invalid]="hasError('recommendation')">
              <option value="">-- Select Option --</option>
              <option *ngFor="let option of recommendationOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
            <div class="invalid-feedback" *ngIf="hasError('recommendation')">
              {{ getErrorMessage('recommendation') }}
            </div>
          </div>
        </div>

        <!-- Campus Liked Section -->
        <div class="section-header mt-4">
          <h4>What did you like most about the campus? <span class="text-danger">*</span></h4>
          <small class="text-muted">(Select at least 2 options)</small>
        </div>

        <div class="mb-3">
          <div class="row">
            <div class="col-md-4 mb-2" *ngFor="let option of campusLikedOptions">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  [id]="'campus-' + option.value"
                  [checked]="isCheckboxSelected(option.value)"
                  (change)="onCheckboxChange($event, option.value)">
                <label class="form-check-label" [for]="'campus-' + option.value">
                  {{ option.label }}
                </label>
              </div>
            </div>
          </div>
          <div class="invalid-feedback d-block" *ngIf="hasError('campusLiked')">
            {{ getErrorMessage('campusLiked') }}
          </div>
        </div>

        <!-- Interest Source Section -->
        <div class="section-header mt-4">
          <h4>How did you become interested in the university? <span class="text-danger">*</span></h4>
        </div>

        <div class="mb-3">
          <div class="row">
            <div class="col-md-3 mb-2" *ngFor="let option of interestSourceOptions">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  name="interestSource"
                  [id]="'interest-' + option.value"
                  [value]="option.value"
                  formControlName="interestSource">
                <label class="form-check-label" [for]="'interest-' + option.value">
                  {{ option.label }}
                </label>
              </div>
            </div>
          </div>
          <div class="invalid-feedback d-block" *ngIf="hasError('interestSource')">
            {{ getErrorMessage('interestSource') }}
          </div>
        </div>

        <!-- Comments Section -->
        <div class="section-header mt-4">
          <h4>Additional Comments</h4>
        </div>

        <div class="mb-3">
          <textarea
            class="form-control"
            id="comments"
            formControlName="comments"
            rows="4"
            placeholder="Please share any additional feedback..."></textarea>
        </div>

        <!-- Form Actions -->
        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="onReset()"
            [disabled]="loading">
            Reset
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="loading">
            <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            {{ isEditMode ? 'Update Survey' : 'Submit Survey' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Navigation -->
  <div class="mt-3">
    <button class="btn btn-outline-secondary" routerLink="/surveys">
      &larr; Back to Survey List
    </button>
  </div>
</div>
